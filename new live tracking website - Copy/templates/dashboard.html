{% extends "base.html" %}
{% block content %}
<style>
    /* Dashboard Specific Styles */
    .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto 1fr; /* Two rows: Top quick links, Bottom sections */
        gap: 30px;
        margin-top: 20px;
    }
    .quick-links {
        grid-column: 1 / 3; /* Spans both columns at the top */
        display: flex;
        gap: 20px;
        justify-content: center;
    }
    .quick-link-card {
        padding: 2rem;
        text-align: center;
        width: 100%;
        max-width: 300px;
        transition: all 0.3s;
        cursor: pointer;
        background: rgba(255, 255, 255, 0.1);
    }
    .quick-link-card h2 { margin-bottom: 0.5rem; }
    .quick-link-card i { font-size: 3rem; margin-bottom: 10px; color: var(--accent); }

    .bottom-section {
        padding: 2rem;
        border-top: 3px solid var(--accent);
    }
    .social-link-icon {
        font-size: 2rem;
        margin-right: 20px;
        transition: color 0.3s;
        color: rgba(255,255,255,0.7);
    }
    .social-link-icon:hover { color: var(--accent); transform: scale(1.1); }
</style>

<div class="fade-in">
    <h1 style="text-align: center; margin-bottom: 50px;">Hello, {{ user.name }}!</h1>

    <div class="dashboard-grid">
        
        <div class="quick-links">
            <a href="/workout" class="quick-link-card card" style="text-decoration: none;">
                <i class="fas fa-video"></i>
                <h2>Live Tracking</h2>
                <p>Start your real-time AI workout session.</p>
            </a>
            <a href="/planner" class="quick-link-card card" style="text-decoration: none;">
                <i class="fas fa-calendar-alt"></i>
                <h2>Planner & Diet</h2>
                <p>Manage your schedule and nutrition.</p>
            </a>
        </div>

        <div class="card bottom-section" id="reportSection">
            <h3 style="color: var(--accent);"><i class="fas fa-chart-line"></i> Performance Report</h3>
            <p>Generate a comprehensive summary of your fitness journey.</p>
            <div id="reportSummary" style="margin-bottom: 15px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; font-size: 0.9rem;">
                Loading summary...
            </div>
            <button onclick="downloadReport()" class="btn btn-primary" style="width: 100%;">
                <i class="fas fa-file-pdf"></i> Download Full Report (PDF)
            </button>
            <p style="font-size: 0.75rem; opacity: 0.7; margin-top: 10px;">
                Note: PDF generation is simulated; it will download a JSON file with all the data needed.
            </p>
        </div>
        
        <div style="display: grid; grid-template-rows: 1fr 1fr; gap: 30px;">
            <div class="card bottom-section">
                <h3 style="color: var(--accent);"><i class="fas fa-info-circle"></i> About AI Fitness Tracker</h3>
                <p style="font-size: 0.9rem;">
                    This application uses Python Flask, MediaPipe, and OpenCV for real-time, markerless pose detection. 
                    It's designed to provide accurate rep counts and form feedback directly from your webcam.
                </p>
            </div>

            <div class="card bottom-section">
                <h3 style="color: var(--accent);"><i class="fas fa-share-alt"></i> Connect With Us</h3>
                <div style="margin-top: 15px;">
                    <a href="https://www.facebook.com" target="_blank" class="social-link-icon"><i class="fab fa-facebook"></i></a>
                    <a href="https://www.twitter.com" target="_blank" class="social-link-icon"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com" target="_blank" class="social-link-icon"><i class="fab fa-instagram"></i></a>
                    <a href="mailto:info@aifitness.com" class="social-link-icon"><i class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function loadReportSummary() {
        fetch('/get_full_report')
            .then(r => r.json())
            .then(data => {
                const summaryDiv = document.getElementById('reportSummary');
                if (data.error || data.total_sessions === 0) {
                    summaryDiv.innerHTML = `<p style="color: rgba(255,255,255,0.7);">No workout history found yet. Start tracking!</p>`;
                    return;
                }

                summaryDiv.innerHTML = `
                    <p>Total Sessions Tracked: <strong>${data.total_sessions}</strong></p>
                    <p>Total Reps Completed: <strong>${data.total_reps}</strong></p>
                    <p>Total Calories Burned: <strong>${data.total_calories} kcal</strong></p>
                    <p>Most Frequent Exercise: <strong>${data.most_frequent_exercise}</strong></p>
                `;
            })
            .catch(() => {
                 document.getElementById('reportSummary').innerHTML = `<p style="color: var(--danger)">Failed to load data.</p>`;
            });
    }

    function downloadReport() {
        fetch('/get_full_report')
            .then(r => r.json())
            .then(data => {
                if (data.error) {
                    alert('Cannot download report: ' + data.error);
                    return;
                }
                
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `AI_Fitness_Report_${data.user_name}_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('Report data downloaded as JSON. This data is what a server-side PDF generator would use.');
            });
    }

    loadReportSummary();
</script>
{% endblock %}